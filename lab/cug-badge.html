<!DOCTYPE html>
<html>
    <head>
        <title>CUG Badge--地大校徽自动生成</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <style type="text/css">
            body {
                margin:0 auto;
                font-family:"Microsoft Yahei","Arial","宋体";
                margin-bottom:20px;
            }
            hr {
                border:1px solid #690;
            }
            p {
                font-size:0.9em;
                text-indent:2em;
                margin:10px 0 10px 0;
            }
            h2 {
                text-align: center;
            }
            input {
                width:100px;
            }
            td {
                width: 100px;
                height: 40px;
                font-size:0.9em;
            }
            #explain{
                float: left;
                margin-left: 40px;
                width: 500px;
            }
            #config{
                width:500px;
                float:right;
            }
            #canvasDiv{
                clear: both;
                margin:0 auto;
            }
            #config-affirm{
                width: 100px;
                background-color: #CDCDCD;
            }
            #export-div{
                margin-left: 40px;
                width:420px;
                margin-top:20px;
            }
            #image-export{
                width:420px;
                margin-left: 150;
                height: 30px;
                background-color: #390;
            }
        </style>
    </head>
    <body>
        <h2>地大校徽自定义获取</h2>
        <hr />
        <div id="explain">
            <h4>说明:</h4>
            <p>1.IE下需要自己输入颜色值，<b>#00000 到 #FFFFFF</b>之间；</p>
            <p>2.半径和线宽的单位为<b>px</b>，半径默认为<b>300</b>，线宽为半径的<b>百分之一</b>；</p>
            <p>3.字体选择目前仅添加了<b>宋体</b>、<b>雅黑</b>和<b>黑体</b>选择，且中英文为同一字体；</p>
            <p>3.目前线条和背景色<b>不支持</b>透明度设置，后续可能考虑增加；</p>
            <p>4.仅支持<b>IE9/10</b>和<b>Chrome</b>，<b>Firefox</b>，<b>Opera</b>等支持<b>Canvas</b>的浏览器；</p>
            <p>5.图片比例为自己估算所得，并不精确；</p>
            <p>6.仅为方便大家使用，代码写的并不好。</p>
            <p>7.适用于论文封面，海报打印等。有官方性质的东西请慎重~~~</p>
        </div>
        <div id="config">
            <h4>配置：</h4>
            <table style="margin-left:40px">
                <tbody>
                    <tr>
                        <td>主体半径:</td>
                        <td>
                            <input type="number" min="50" id="radius" name="radius" value="300" />
                        </td>
                        <td>线条宽度:</td>
                        <td>
                            <input type="number" min="1" id="line-width" name="line-width" />
                        </td>
                    </tr>
                    <tr>
                        <td>字体颜色:</td>
                        <td>
                            <input type="color" id="font-color" name="font-color" value="#000000"/>
                        </td>
                        <td>线条颜色:</td>
                        <td>
                            <input type="color" id="color" name="color" value="#CDCDCD"/>
                        </td>
                    </tr>
                    <tr>
                        <td>地球背景颜色:</td>
                        <td>
                            <input type="color" id="earth-color" name="font-color" value="#0080C0"/>
                        </td>
                        <td>文字背景颜色:</td>
                        <td>
                            <input type="color" id="font-back-color" name="font-color" value="#FFFFFF"/>
                        </td>
                    </tr>
                    <tr>
                        <td>字体选择:</td>
                        <td>
                            <select id="font-select" style="width:100px">
                                <option value="SimSun">宋体</option>
                                <option value="Microsoft Yahei">微软雅黑</option>
                                <option  value="SimHei">黑体</option>
                            </select>
                        </td>
                        <td style="color:red;">点击确认--></td>
                        <td>
                            <input type="button" id="config-affirm" value="确认" />
                        </td>
                    </tr>
                </tbody>
            </table>
            <div id="export-div"><button id="image-export">导出图像</button></div>
        </div>
        <div id="canvasDiv"></div>
        <div>
            <hr />
            <p style="text-align: center;font-size:0.75em;">&copy;2012;Page By Scholer</p>
        </div>
    </body>
    <script type="text/javascript">
        function canvasTagCreate(id,w,h,parentId){
            var canvasDom = document.createElement("canvas");
            canvasDom.setAttribute('id',id);
            canvasDom.setAttribute('width',w);
            canvasDom.setAttribute('height',h);
            canvasDom.innerHTML = "If you can see these words,obviously,you need a new browser!"
            var parentDom = document.getElementById(parentId);
            parentDom.appendChild(canvasDom);
            var context = canvasDom.getContext('2d');
            context.clearRect(0,0,w,h);
            return context;
        }
        function createCircle(context,x,y,radius,color,lineW,bColor){
            context.save();
            context.beginPath();
            context.arc(x,y,radius, 0 , 2 * Math.PI, false);
            context.fillStyle = color;
            context.fill();
            context.lineWidth = lineW;
            context.strokeStyle = bColor;
            context.stroke();
            context.restore();
        }
        function createEllipse(context,x,y,a,b,color,lineW,bColor){
            context.save();
            var r = (a > b) ? a : b; 
            var ratioX = a / r;
            var ratioY = b / r;
            context.scale(ratioX, ratioY);
            context.beginPath();
            context.arc(x / ratioX, y / ratioY, r, 0, 2 * Math.PI);
            context.fillStyle = color;
            context.fill();
            context.lineWidth = lineW;
            context.strokeStyle = bColor;
            context.stroke();
            context.restore();
        }
        function createLine(context,sx,sy,ex,ey,lineW,bColor){
            context.save();
            context.beginPath();
            context.moveTo(sx,sy);
            context.lineTo(ex,ey);
            context.lineWidth = lineW;
            context.strokeStyle = bColor;
            context.stroke();
            context.restore();
        }
        function cereatHammer(context,cx,cy,radius,w,color,lineW,bColor){
            context.save();

            context.beginPath();
            context.moveTo(cx-radius/2,cy-radius*Math.cos(Math.PI * 30 / 180));
            context.lineTo(cx+w/2,cy-radius*Math.cos(Math.PI * 30 / 180));
            context.lineTo(cx+radius/2+w,cy-radius*Math.cos(Math.PI * 30 / 180)+w);
            context.lineTo(cx+w/2,cy-radius*Math.cos(Math.PI * 30 / 180)+w);
            context.lineTo(cx+w/2,cy-w);
            context.lineTo(cx+radius,cy);
            context.lineTo(cx+w/2,cy+w);
            context.lineTo(cx+w/2,cy+radius-w/2);
            context.lineTo(cx-w/2,cy+radius-w/2);
            context.lineTo(cx-w/2,cy+w);
            context.lineTo(cx-radius,cy);
            context.lineTo(cx-w/2,cy-w);
            context.lineTo(cx-w/2,cy-radius*Math.cos(Math.PI / 6)+w);
            context.lineTo(cx-radius/2,cy-radius*Math.cos(Math.PI / 6)+w);
            context.closePath();
            context.fillStyle = color;
            context.fill();
            context.lineWidth = lineW;
            context.strokeStyle = bColor;
            context.stroke();

            context.beginPath();
            context.moveTo(cx-w/2,cy);
            context.lineTo(cx-w/2,cy-w+lineW);
            context.lineTo(cx+w/2-radius+2*lineW*Math.cos(Math.PI / 3),cy);
            context.closePath();
            context.fillStyle = "#FFF";
            context.fill();

            context.beginPath();
            context.moveTo(cx+w/2,cy);
            context.lineTo(cx+w/2,cy+w-lineW);
            context.lineTo(cx-w/2+radius-2*lineW*Math.cos(Math.PI / 3),cy);
            context.closePath();
            context.fillStyle = "#FFF";
            context.fill();

            context.restore();
        }
        function createWords(context,cx,cy,ri,ro,color,font){
            context.save();
            radius = ri + (ro - ri)/2;
            var words = "质 大 学 CHINA UNIVERSITY OF GEOSCIENCES 中 国 地 ";
            var angle = 2 * Math.PI / words.length;
            context.translate(cx,cy);
            context.font = (ri*2/10) + "pt " + font;
            context.fillStyle = color;
            context.textAlign = 'center';
            context.textBaseline = 'middle';
            for (var i = 0;i < words.length; i++) {
                context.save();
                if (i > 5 && i < 38) {
                    var j = words.length - i - 1;
                    context.translate(radius * Math.sin(angle*j), - radius * Math.cos(angle*j));
                    context.rotate(angle * j + Math.PI);
                    context.fillText(words[i], 0,0);
                    context.translate(- radius * Math.sin(angle*j),radius * Math.cos(angle*j));
                }
                else {
                    context.translate(radius * Math.sin(angle*(i+1)), - radius * Math.cos(angle*(i+1)));
                    context.rotate(angle * (i+1));
                    context.fillText(words[i], 0,0);
                    context.translate(- radius * Math.sin(angle*(i+1)),radius * Math.cos(angle*(i+1)));
                }
                context.restore();
            }
            context.restore();
        }

        function createBadge(){
            //半径,单位px
            var r = Number(document.getElementById('radius').value) || 300;
            //线条颜色
            var boderColor = document.getElementById('color').value || "#CDCDCD";
            //字体颜色
            var fontColor = document.getElementById('font-color').value || "#000";
            //线条宽度,单位px
            var lineW = Number(document.getElementById('line-width').value) || r/100;
            //地球仪背景色
            var erathColor = document.getElementById('earth-color').value || "#0080C0";
            //文字背景色
            var wordsBackColor = document.getElementById('font-back-color').value || "#FFF";
            //文字字体
            var selectDom = document.getElementById('font-select');
            var fontIndex = selectDom.selectedIndex;
            var font = selectDom.options[fontIndex].value || "SimSun";

            var canvasWidth = 2 * r + 2*lineW;
            var canvasHeight = 2 * r + 2*lineW;
            var ccx = canvasWidth / 2;
            var ccy = canvasHeight / 2;
            var ra = r * 3 / 4;
            var rb = r / 2;
            var rc = r / 4;
            var rd = r * 5 / 8;
            var re = ra / 2;
            var ox = ra * Math.cos(Math.PI / 6);

            document.getElementById('canvasDiv').style.width = canvasWidth + "px";
            document.getElementById('canvasDiv').innerHTML = "";

            var context = canvasTagCreate('myCanvas',canvasWidth,canvasHeight,'canvasDiv');
            /*
            *貌似IE10不支持context.globalCompositeOperation = "destination-atop"
            *的方法，所以为了兼容IE10,我只用了'source-atop';
            *然后又多画了一个圈;
            */
            //地球仪的框架圆
            createCircle(context,ccx,ccy,ra,erathColor,0,"#FFF");
            context.globalCompositeOperation = "source-atop";
            //地球仪纵向的两个椭圆
            createEllipse(context,ccx,ccy,rd,ra,"rgba(255,255,255,0)",lineW,boderColor);
            createEllipse(context,ccx,ccy,rb,ra,"rgba(255,255,255,0)",lineW,boderColor);
            //四条直线
            createLine(context,ccx-ra,ccy,ccx+ra,ccy,lineW,boderColor);
            createLine(context,ccx-ox,ccy-re,ccx+ox,ccy+re,lineW,boderColor);
            createLine(context,ccx-ox,ccy+re,ccx+ox,ccy-re,lineW,boderColor);
            createLine(context,ccx,ccy-ra,ccx,ccy+ra,lineW,boderColor); 
            //锤子外围的圆
            createCircle(context,ccx,ccy,rb,erathColor,lineW,boderColor);
            //地球上下两部分的椭圆
            createEllipse(context,ccx,ccy-ra,rc,rc / 2,erathColor,lineW,boderColor);
            createEllipse(context,ccx,ccy+ra,rc,rc / 2,erathColor,lineW,boderColor);
            
            context.globalCompositeOperation = "destination-over";
            //最外围的大圆,填充了颜色的部分会遮罩住部分线条,所以将线宽*2;
            createCircle(context,ccx,ccy,r,wordsBackColor,lineW*2,boderColor);

            context.globalCompositeOperation = "source-over";
            //地球仪外围的圆
            createCircle(context,ccx,ccy,ra,"rgba(255,255,255,0)",lineW,boderColor);
            //锤子
            cereatHammer(context,ccx,ccy,rb,r*4/50,"#AAA",lineW,boderColor);
            //文字
            createWords(context,ccx,ccy,ra,r,fontColor,font);
        }

        createBadge();
        document.getElementById('config-affirm').onclick = function(){
            createBadge();
        };
        document.getElementById('image-export').onclick = function(){
            var imgURL = document.getElementById('myCanvas').toDataURL();
            var newHTML = '<!DOCTYPE html><html><head>';
            newHTML += '<meta charset="utf-8" /></head><body>';
            newHTML += '<p><b>请另存图片*^_^*</b></p>';
            newHTML += '<img src="' + imgURL + '" />';
            newHTML += '</body></html>';

            var openWindow = window.open('',"smallwin","width=620,height=700");
            openWindow.document.write(newHTML);
        };
    </script>
</html>